{"version":3,"sources":["Game.js"],"names":["Bird","require","PipeManager","Scroller","cc","Class","extends","Component","properties","goldScore","silverScore","pipeManager","bird","scoreLabel","Label","maskLayer","default","type","Node","ground","background","readyMenu","gameOverMenu","onLoad","score","string","init","_enableInput","_revealScene","active","color","Color","BLACK","runAction","fadeOut","enable","systemEvent","on","SystemEvent","EventType","KEY_DOWN","onKeyDown","node","TOUCH_START","onTouch","off","_startGameOrJumpBird","_hideReadyMenu","sequence","callFunc","state","State","Ready","_gameStart","rise","startSpawn","startFly","gameOver","reset","getComponent","stopScroll","_blinkOnce","_showGameOverMenu","WHITE","fadeTo","gameOverNode","getChildByName","resultBoardNode","startButtonNode","currentScoreNode","bestScoreNode","medalNode","KEY_BEST_SCORE","bestScore","sys","localStorage","getItem","setItem","showMedal","err","spriteFrame","Sprite","loader","loadRes","showNode","action","callback","showNodeFunc","spawn","fadeIn","moveBy","p","moveTo","x","easing","easeCubicActionOut","scheduleOnce","gainScore","restart","director","loadScene"],"mappings":"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","file":"Game.js","sourceRoot":"..\\..\\..\\..\\assets\\script","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\r\nvar Bird = require('Bird');\r\nvar PipeManager = require('PipeManager');\r\nvar Scroller = require('Scroller');\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        /** 得金牌的分数 */\r\n        goldScore: 30,\r\n        /** 得银牌的分数 */\r\n        silverScore: 10,\r\n        /** 管道管理组件 */\r\n        pipeManager: PipeManager,\r\n        /** 小鸟组件 */\r\n        bird: Bird,\r\n        /** 分数显示节点 */\r\n        scoreLabel: cc.Label,\r\n        /** 遮罩节点 */\r\n        maskLayer: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n        /** 地面节点 */\r\n        ground: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n        /** 背景节点 */\r\n        background: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n        /** 准备开始菜单节点 */\r\n        readyMenu: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n        /** 游戏结束的菜单节点 */\r\n        gameOverMenu: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad() {\r\n        this.score = 0;\r\n        this.scoreLabel.string = this.score;\r\n        this.bird.init(this);\r\n        this._enableInput(true);\r\n        this._revealScene();\r\n    },\r\n    _revealScene() {\r\n        this.maskLayer.active = true;\r\n        this.maskLayer.color = cc.Color.BLACK;\r\n        this.maskLayer.runAction(cc.fadeOut(0.3));\r\n    },\r\n\r\n    _enableInput(enable) {\r\n        if (enable) {\r\n            cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\r\n            this.node.on(cc.Node.EventType.TOUCH_START, this.onTouch, this);\r\n        } else {\r\n            cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\r\n            this.node.off(cc.Node.EventType.TOUCH_START, this.onTouch, this);\r\n        }\r\n    },\r\n    onKeyDown() {\r\n        this._startGameOrJumpBird();\r\n    },\r\n\r\n    onTouch() {\r\n        this._startGameOrJumpBird();\r\n        return true;\r\n    },\r\n    _hideReadyMenu() {\r\n        this.readyMenu.runAction(\r\n            cc.sequence(\r\n                cc.fadeOut(0.5),\r\n                cc.callFunc(() => {\r\n                    this.readyMenu.active = false;\r\n                }, this)\r\n            )\r\n        );\r\n    },\r\n    //开始或者飞行\r\n    _startGameOrJumpBird() {\r\n        if (this.bird.state === Bird.State.Ready) {\r\n            this._gameStart();\r\n        } else {\r\n            this.bird.rise();//继续飞行\r\n        }\r\n    },\r\n    //游戏开始\r\n    _gameStart() {\r\n        this._hideReadyMenu();//隐藏menu\r\n        this.pipeManager.startSpawn();//生产管道\r\n        this.bird.startFly();//开始飞行\r\n    },\r\n    gameOver() {\r\n        this.pipeManager.reset();\r\n        this.ground.getComponent(Scroller).stopScroll();//地板停止滚动\r\n        this.background.getComponent(Scroller).stopScroll();//背景停止滚动\r\n        this._enableInput(false);//停止接受事件\r\n        this._blinkOnce();//闪烁一下\r\n        this._showGameOverMenu();//显示有些结束菜单\r\n    },\r\n\r\n    /** 屏幕闪烁一下 */\r\n    _blinkOnce() {\r\n        this.maskLayer.color = cc.Color.WHITE;\r\n        this.maskLayer.runAction(\r\n            cc.sequence(\r\n                cc.fadeTo(0.1, 200),\r\n                cc.fadeOut(0.1)\r\n            )\r\n        );\r\n    },\r\n    _showGameOverMenu() {\r\n        // 隐藏分数\r\n        this.scoreLabel.node.runAction(\r\n            cc.sequence(\r\n                cc.fadeOut(0.3),\r\n                cc.callFunc(() => {\r\n                    this.scoreLabel.node.active = false;\r\n                }, this)\r\n            )\r\n        );\r\n\r\n        // 获取游戏结束界面的各个节点\r\n        let gameOverNode = this.gameOverMenu.getChildByName(\"gameOverLabel\");\r\n        let resultBoardNode = this.gameOverMenu.getChildByName(\"resultBoard\");\r\n        let startButtonNode = this.gameOverMenu.getChildByName(\"startButton\");\r\n        let currentScoreNode = resultBoardNode.getChildByName(\"currentScore\");\r\n        let bestScoreNode = resultBoardNode.getChildByName(\"bestScore\");\r\n        let medalNode = resultBoardNode.getChildByName(\"medal\");\r\n\r\n        // 保存最高分到本地\r\n        const KEY_BEST_SCORE = \"bestScore\";\r\n        let bestScore = cc.sys.localStorage.getItem(KEY_BEST_SCORE);\r\n        if (bestScore === \"null\" || this.score > bestScore) {\r\n            bestScore = this.score;\r\n        }\r\n        cc.sys.localStorage.setItem(KEY_BEST_SCORE, bestScore);\r\n\r\n        // 显示当前分数、最高分\r\n        currentScoreNode.getComponent(cc.Label).string = this.score;\r\n        bestScoreNode.getComponent(cc.Label).string = bestScore;\r\n\r\n        // 决定是否显示奖牌\r\n        let showMedal = (err, spriteFrame) => {\r\n            medalNode.getComponent(cc.Sprite).spriteFrame = spriteFrame;\r\n        };\r\n        if (this.score >= this.goldScore) { // 显示金牌\r\n            cc.loader.loadRes(\"image/medal_gold.png/medal_gold\", showMedal);\r\n        } else if (this.score >= this.silverScore) { // 显示银牌\r\n            cc.loader.loadRes(\"image/medal_silver.png/medal_silver\", showMedal);\r\n        } else { // 不显示奖牌\r\n            showMedal();\r\n        }\r\n\r\n        // 依次显示各个节点\r\n        var showNode = (node, action, callback) => {\r\n            startButtonNode.active = true;\r\n            node.runAction(cc.sequence(\r\n                action,\r\n                cc.callFunc(() => {\r\n                    if (callback) {\r\n                        callback();\r\n                    }\r\n                }, this)\r\n            ));\r\n        };\r\n        this.gameOverMenu.active = true;\r\n        let showNodeFunc = () => showNode(\r\n            gameOverNode,\r\n            cc.spawn(\r\n                cc.fadeIn(0.2),\r\n                cc.sequence(\r\n                    cc.moveBy(0.2, cc.p(0, 10)),\r\n                    cc.moveBy(0.5, cc.p(0, -10))\r\n                )\r\n            ),\r\n            () => showNode(\r\n                resultBoardNode,\r\n                cc.moveTo(0.5, cc.p(resultBoardNode.x, 0)).easing(cc.easeCubicActionOut()),\r\n                () => showNode(\r\n                    startButtonNode,\r\n                    cc.fadeIn(0.5))\r\n            )\r\n        );\r\n        this.scheduleOnce(showNodeFunc, 0.55);\r\n    },\r\n    gainScore() {\r\n        this.score++;\r\n        this.scoreLabel.string = this.score;\r\n    },\r\n    /** 点击游戏结束菜单中的重新开始游戏按钮会调用此方法 */\r\n    restart() {\r\n        this.maskLayer.color = cc.Color.BLACK;\r\n        this.maskLayer.runAction(\r\n            cc.sequence(\r\n                cc.fadeIn(0.3),\r\n                cc.callFunc(() => {\r\n                    // 重新加载场景\r\n                    cc.director.loadScene('game');\r\n                }, this)\r\n            )\r\n        );\r\n    },\r\n    // update (dt) {},\r\n});\r\n"]}