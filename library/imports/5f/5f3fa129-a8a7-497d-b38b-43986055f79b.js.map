{"version":3,"sources":["..\\..\\..\\..\\assets\\script/assets\\script\\Bird.js"],"names":["State","cc","Enum","Ready","Rise","FreeFall","Drop","Dead","Class","statics","extends","Component","properties","initRiseSpeed","gravity","state","default","type","ground","Node","riseAudio","url","AudioClip","dropAudio","hitAudio","init","game","currentSpeed","anim","getComponent","Animation","update","dt","_updatePosition","_updateState","_detectCollision","_fixBirdFinalPosition","flying","h","director","getVisibleSize","height","node","y","_runFallAction","_runRiseAction","audioEngine","playEffect","rise","startFly","_getNextPipe","stop","stopAllActions","jumpAction","rotateTo","easing","easeCubicActionOut","runAction","duration","dropAction","easeCubicActionIn","_runDropAction","nextPipe","pipeManager","getNext","collideWithPipe","_detectCollisionWithBird","topPipe","bottomPipe","collideWithGround","gameOver","birdLeft","x","pipeRight","width","crossPipe","gainScore","otherNode","rectIntersectsRect","getBoundingBoxToWorld"],"mappings":"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","file":"Bird.js","sourceRoot":"..\\..\\..\\..\\assets\\script","sourcesContent":["const State = cc.Enum({\n    /** 游戏开始前的准备状态 */\n    Ready: -1,\n    /** 小鸟上升中 */\n    Rise: -1,\n    /** 小鸟自由落体中 */\n    FreeFall: -1,\n    /** 小鸟碰撞到管道坠落中 */\n    Drop: -1,\n    /** 小鸟已坠落到地面静止 */\n    Dead: -1,\n});\n\ncc.Class({\n    statics: {\n        State: State\n    },\n\n    extends: cc.Component,\n\n    properties: {\n        /** 上抛初速度，单位：像素/秒 */\n        initRiseSpeed: 800,\n        /** 重力加速度，单位：像素/秒的平方 */\n        gravity: 1000,\n        /** 小鸟的状态 */\n        state: {\n            default: State.Ready,\n            type: State,\n        },\n        /** 地面节点 */\n        ground: {\n            default: null,\n            type: cc.Node\n        },\n        // 小鸟向上飞的声音\n        riseAudio:{\n            default:null,\n            url:cc.AudioClip\n        },\n        // 碰掉水管掉落声\n        dropAudio:{\n            default:null,\n            url:cc.AudioClip\n        },\n        // 发生碰撞声\n        hitAudio:{\n            default:null,\n            url:cc.AudioClip\n        },\n    },\n\n    init(game) {\n        this.game = game;\n        this.state = State.Ready;\n        this.currentSpeed = 0;//初始化当前的速度\n        this.anim = this.getComponent(cc.Animation);//获取动画组件\n    },\n    update(dt) {\n        if (this.state === State.Ready || this.state === State.Dead) {//如果是住呢比或者死亡状态则停止计算\n            return;\n        }\n        this._updatePosition(dt);\n        this._updateState(dt);\n        this._detectCollision();\n        this._fixBirdFinalPosition();\n\n    },\n    _updatePosition(dt) {\n        var flying = this.state === State.Rise\n            || this.state === State.FreeFall\n            || this.state === State.Drop;//判断小鸟是否处于飞行状态\n        if (flying) {//如果处于飞行状态\n            var h = cc.director.getVisibleSize().height / 2;\n            if (this.node.y >= h) {//当小鸟的高度超过上边的时候，让小鸟的位置和速度降下来\n                this.node.y = h - 1;\n                this.currentSpeed = -1;\n            } else {\n                this.currentSpeed -= dt * this.gravity;//根据预先设置好的重力计算当前的速度\n                this.node.y += dt * this.currentSpeed;//根据计算出来的y轴速度，计算出当前小鸟的位置\n            }\n        }\n    },\n\n    _updateState(dt) {\n        switch (this.state) {\n            case State.Rise://当当前状态是飞起的时候，如果速度小于零了，则转换为自由下落状态\n                if (this.currentSpeed < 0) {\n                    this.state = State.FreeFall;\n                    this._runFallAction();\n                    this._runRiseAction();\n        cc.audioEngine.playEffect(this.dropAudio)\n\n                }\n                break;\n        }\n    },\n    //起飞函数\n    rise() {\n        this.state = State.Rise;\n        this.currentSpeed = this.initRiseSpeed;\n        this._runRiseAction();\n        //\n        cc.audioEngine.playEffect(this.riseAudio)\n    \n    },\n    //开始起飞\n    startFly() {\n        this._getNextPipe();\n        this.anim.stop(\"birdFlapping\");\n        this.rise();\n    },\n    //向上飞的角度偏移\n    _runRiseAction() {\n        this.node.stopAllActions();\n        let jumpAction = cc.rotateTo(0.3, -30).easing(cc.easeCubicActionOut());\n        this.node.runAction(jumpAction);\n    },\n\n    //下落的角度偏移\n    _runFallAction(duration = 0.6) {\n        this.node.stopAllActions();\n        let dropAction = cc.rotateTo(duration, 90).easing(cc.easeCubicActionIn());\n        this.node.runAction(dropAction);\n    },\n\n    //当小鸟碰撞到管道的时候坠落的角度偏移\n    _runDropAction() {\n        if (this.currentSpeed > 0) {\n            this.currentSpeed = 0;\n        }\n        this._runFallAction(0.4);\n    },\n    _getNextPipe() {\n        this.nextPipe = this.game.pipeManager.getNext();\n    },\n    _detectCollision() {\n        if (!this.nextPipe) {\n            return;\n        }\n        if (this.state === State.Ready || this.state === State.Dead || this.state === State.Drop) {\n            return;\n        }\n        let collideWithPipe = false;\n        // 检测小鸟与上方管子的碰撞\n        if (this._detectCollisionWithBird(this.nextPipe.topPipe)) {\n            collideWithPipe = true;\n        }\n        // 检测小鸟与下方管子的碰撞\n        if (this._detectCollisionWithBird(this.nextPipe.bottomPipe)) {\n            collideWithPipe = true;\n        }\n        // 检测小鸟与地面的碰撞\n        let collideWithGround = false;\n        if (this._detectCollisionWithBird(this.ground)) {\n            collideWithGround = true;\n        }\n        // 处理碰撞结果\n        if (collideWithPipe || collideWithGround) {\n        cc.audioEngine.playEffect(this.hitAudio)\n\n            if (collideWithGround) { // 与地面碰撞\n                this.state = State.Dead;\n            } else { // 与水管碰撞\n                this.state = State.Drop;\n                this._runDropAction();\n            }\n            this.anim.stop();\n            this.game.gameOver();\n        } else { // 处理没有发生碰撞的情况\n            let birdLeft = this.node.x;\n            let pipeRight = this.nextPipe.node.x + this.nextPipe.topPipe.width\n            let crossPipe = birdLeft > pipeRight;\n            if (crossPipe) {\n                this.game.gainScore();\n                this._getNextPipe();\n            }\n        }\n        // 处理碰撞结果\n        if(collideWithPipe || collideWithGround){\n            cc.audioEngine.playEffect(this.hitAudio)\n        }\n    },\n    _detectCollisionWithBird(otherNode) {\n        return cc.rectIntersectsRect(this.node.getBoundingBoxToWorld(), otherNode.getBoundingBoxToWorld());\n    },\n    /** 修正最后落地位置 */\n    _fixBirdFinalPosition() {\n        if (this._detectCollisionWithBird(this.ground)) {\n            this.node.y = this.ground.y + this.node.width / 2;\n        }\n    },\n});\n"]}